# 2025-08-11 - Supabase, SQLite, Models

## Supabase and SQLite
I implemented my databases according to the schema I described previously, following best practices for naming convetions with SQL databases. To be specific, I maintained all lower case names with underscore separators between words. I read that there is some debate as to whether or not table names should be singular or plural, so I decided to name mine in the plural form, because it appealed to my aesthetic tastes (haha). Here you can find the SQL for both the [local](/docs/ood_process/databases/sqlite-schema.md) and [remote](/docs/ood_process/databases/supabase-schema.md) schemas. 
One major aspect of this implementation that was at the top of my mind at the outset of the process was synchronization between the remote and offline databases with my offline-first approach to the app. Some of the links I was reading are found in the Realtime Notes section below. The `workmanager` package offers some background sync capabilities, and I want to pair it with the `connectivity_plus` and `battery_plus` plugins to be sure that when background syncing doesn't tax the resources of users devices too heavily. A fun surprise during my reading was the push-notification functionality I can set up for my database, which I envision using whenever a new regulation is released.
I also elected to remove sprites from both the Pokemon and Items tables, as I believe it makes more sense to store the image files locally and ship it with the app because
1. the image files would swell the size of the databases meaningfully and
2. working with the images in supabase or sqlite require non-traditional approaches, but
3. pokemon and item sprites hardly ever change unless new pokemon/items are introduced, which only happens when a new game releases, and finally
4. new game releases bring about new mechanics that fundamentally change battling and teambuilding, so I anticipate releasing full updates for those anyhow

## Initial Model Implementation
I have also (finally!) begun building my models in dart code. I made a few more adjustments to some attribute names for the Pokemon and Move classes for clarity. I removed MovePools and AbilityPools as attributes for the Pokemon model, introducing MovePoolEntry and AbilityPoolEntry in their stead. As I wrote that sentence out I realized that I may need to refactor the Slot model to use MovePoolEntry and AbilityPoolEntry in place of Moves and Abilities so that the extra info can be readily available for the UI. Tomorrow's problem.
Anyway, I found the `freezed` package that handles all the boilerplate (hash/==/copyWith) methods for immutable class types. It automatically generates the code for those methods when you annotate your class with @freezed and have it implement an interface (which is also generated by `freezed`), and I appreciate the readability it affords the model classes. So far, I have completed the [pokemon model](/app/lib/model/pokemon_model.dart) and the [move model](/app/lib/model/move_model.dart). They necessitated some simple enums as described in the [classes and responsibilities document](/docs/ood_process/classes-and-responsibilities.md), but were otherwise very simple. I'm excited to continue tomorrow, where I hope to complete the models and begin writing method contracts for all components of the app. 

## Realtime Notes
- Reading this guide on push notifications (the release of a new regulation could be a good time to send a push notification to users):https://supabase.com/docs/guides/functions/examples/push-notifications?queryGroups=platform&platform=fcm
- Researching database sync methods for flutter: https://docs.flutter.dev/app-architecture/design-patterns/offline-first
- Found `freezed` package that could be helpful when setting up models. Handles boilerplate methods for classes. https://pub.dev/packages/freezed
- Using above for static data holder classes
- Use `dart run build_runner watch -d` to have code generate automatically on save of @freezed class file
- Found `workmanager` package that can run background processes for apps (useful for database synchronization) https://pub.dev/packages/workmanager
- Added legality flag to moves (to denote those that are not currently present on nintendo switch/current games)
- Added AbilityPoolEntry and MovePoolEntry classes to classes and responsibilities, as I realized I had no way to handle the extra info required for things like move learn method indicators, or ability hidden status indicators
- Removed abilityPool and movePool attributes from Pokemon as these can be lazy loaded with a query from the db and its unnecessary to store them with the Pokemon
- Renamed Pokemon.preEvolution -> Pokemon.isPreEvolution for clarity
- Considering opting out of storing sprites in databases at all. If new sprites become available, new pokemon/items have become available, and that usually means a new game with new functional changes that would necessitate an update. Because of this, I've elected to store sprites as assets in the project rather than try to store/retrieve them from the database for now.
- Renamed slot.gigantamax -> slot.isGigantamax for clarity
- Need to delete slots members of team from db when deleting team from db
- created supabase schema and documented at docs/ood_process/databases/supabase-schema.md
- created sqlite schema here: app/assets/teambuilder-database.db and docs/ood_process/databases/sqlite-schema.md